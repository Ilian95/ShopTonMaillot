#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>



// Structure Produit
typedef struct {
  char nom[30];
  int num_ref;
  int qte;
  int prix;
  char taille[20];
} Produit;


// Fonction créant un produit
Produit CreateProduit() {
  Produit p;

  printf("Entrer le nom du produit: \n");
  scanf("%s", p.nom);
  while(strlen(p.nom) > 30 || strlen(p.nom) <= 0){
    printf("Erreur sur le nom : ");
    printf("Entrer le nom du produit: \n");
    scanf("%s", p.nom);
  }
  //Choisi un num de ref aléatoire pour le produit
  p.num_ref = rand() % 1001 + 10000;
  //Choisi une quantité aléatoire pour le produit
  p.qte = rand() % 101;
  printf("Entrer le prix du produit: \n");
  scanf("%d", &p.prix);
  
  printf("Entrer la taille du produit : (petit, moyen ou grand) \n");
  scanf("%s", p.taille);

  return p;
}


// Permet de stocker un produit dans un fichier
FILE* FichierProduit(Produit p) {
  FILE *fichier;
  char nom[30];

  strcpy(nom,p.nom);
  
  strcat(nom, ".txt");
  fichier = fopen(nom, "w");

  // Verifie l'accessibilité du fichier
  if (fichier == NULL) {
    printf("Ouverture du fichier impossible\n");
    exit(1);
  }

  // Ecrit chaque valeur du produit dans un fichier
  fprintf(fichier, "%s \n", p.nom);
  fprintf(fichier, "%d \n", p.num_ref);
  fprintf(fichier, "%d \n", p.qte);
  fprintf(fichier, "%d \n", p.prix);
  fprintf(fichier, "%s \n", p.taille);
  
  fclose(fichier);

  FILE* fichier2 = fopen("produit.txt", "a");
  fprintf(fichier, "%s \n", p.nom);
  fclose(fichier2);

  return fichier;
}


//Affiche la liste des produits
void ListP(){
  FILE* f;
  f = fopen("produit.txt", "r");
  if (f == NULL){
    printf("Ouverture du fichier impossible\n");
    exit(1);
  }

  printf("\nVoici la liste des produits :\n\n");
  
  char str[30];
  while(fgets(str, 30, f) != NULL){ 
    printf("- %s", str);
  }
  printf("\n");

  fclose(f);
}


//Lance le mode gestion
void Gestion(){
  Produit p;
  
  printf("\n");
  printf("##################################### \n");
  printf("             MODE GESTION \n");
  printf("##################################### \n");
  printf("\n");

  int choix;
  printf("Appuyer sur 1 pour la liste des produits; \n \nAppuyer sur 2 pour chercher le stock d'un produit; \n \nAppuyer sur 3 pour augmenter le stock d'un produit; \n \nAppuyer sur 4 pour afficher la place disponible dans   le magasin; \n \nAppuyer sur 5 pour ajouter un produit; \n\n");
  scanf("%d", &choix);

  switch(choix){
    case 1:
      ListP();
      break;
    case 2:
      printf("A FAIRE");
      break;
    case 3:
      printf("A FAIRE");
      break;
    case 4:
      printf("A FAIRE");
      break;
    case 5:
      p = CreateProduit();
      FILE* f = FichierProduit(p);
      printf("Voici la nouvelle liste des produits:\n");
      ListP();
      break;
    default:
      printf("Erreur de saisie...");
      Gestion();
      break;
  }
}


// Structure Client
typedef struct{
  char nom[50];
  char prenom[50];
  char historique_achat[2];
}Client;


// Fonction qui crée un client 
Client créer_client(){
  Client client;
  printf("Entrer le nom du client \n");
  scanf("%s",client.nom);
  printf("Entrer le prénom du client \n");
  scanf("%s",client.prenom);
  return client;
}

// Permet de stocker un client dans fichier
FILE* FichiersClient(Client client){
  FILE* fichier;
    char nom[50];

  printf("Saisissez le nom du fichier pour le client: %s \n", client.nom);
  scanf("%s.txt", nom);

  fichier = fopen(nom, "w");

  // Verifie l'accessibilité du fichier
  if (fichier == NULL) {
    printf("Ouverture du fichier impossible\n");
    exit(1);
  }

  // Ecrit les données du client dans un fichier
  fprintf(fichier, "%s \n", client.nom);
  fprintf(fichier, "%s \n", client.prenom);

  return fichier;
}



int main(void) {

  //Initialise les premiers produits
  
  //Produit PSG
  Produit p1;
  strcpy(p1.nom,"PSG");
  p1.num_ref = rand() % 1001 + 10000;
  p1.qte = rand() % 101;
  p1.prix = 55;
  strcpy(p1.taille,"moyen");
  FILE* f1 = FichierProduit(p1);

  //Produit REAL
  Produit p2;
  strcpy(p2.nom,"REAL");
  p2.num_ref = rand() % 1001 + 10000;
  p2.qte = rand() % 101;
  p2.prix = 55;
  strcpy(p2.taille,"moyen");
  FILE* f2 = FichierProduit(p2);
  
  //Produit BARCA
  Produit p3;
  strcpy(p3.nom,"BARCA");
  p3.num_ref = rand() % 1001 + 10000;
  p3.qte = rand() % 101;
  p3.prix = 55;
  strcpy(p3.taille,"moyen");
  FILE* f3 = FichierProduit(p3);

  //Produit CITY
  Produit p4;
  strcpy(p4.nom,"CITY");
  p4.num_ref = rand() % 1001 + 10000;
  p4.qte = rand() % 101;
  p4.prix = 55;
  strcpy(p4.taille,"moyen");
  FILE* f4 = FichierProduit(p4);
  
  //Produit BAYERN
  Produit p5;
  strcpy(p5.nom,"BAYERN");
  p5.num_ref = rand() % 1001 + 10000;
  p5.qte = rand() % 101;
  p5.prix = 55;
  strcpy(p5.taille,"moyen");
  FILE* f5 = FichierProduit(p5);

  // Crée client 1
  FILE *fichierclient1;
  Client client1 = créer_client();
  fichierclient1=FichiersClient(client1);
  
  //Permet de choisir entre mode gestion ou achat
  char mode[30];  
  printf("Bonjour !\nChoisissez entre mode gestion ou mode achat: \n");
  scanf("%s",mode);
  if(strcmp(mode, "gestion") == 0) {
    Gestion();
  }
  else if(strcmp(mode, "achat") == 0) {
    printf("Bienvenue dans le mode achat \n");
  }
  else{
    printf("Erreur de saisie... \n");
    exit(1);
  }

  //Supprime le contenu du fichier produit.txt
  FILE* f = fopen("produit.txt", "w");
  fclose(f);

  return 0;
}

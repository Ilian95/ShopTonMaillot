#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>


// Structure Produit
typedef struct {
  char nom[30];
  int num_ref;
  int qte;
  int prix;
  int taille;
} Produit;


// Fonction créant un produit
Produit CreateProduit() {
  Produit p;

  printf("Entrer le nom du produit: \n");
  scanf("%s", p.nom);
  while(strlen(p.nom) > 30 || strlen(p.nom) <= 0){
    printf("Erreur sur le nom : ");
    printf("Entrer le nom du produit: \n");
    scanf("%s", p.nom);
  }
  //Choisi un num de ref aléatoire pour le produit
  p.num_ref = rand() % 1001 + 10000;
  //Choisi une quantité aléatoire pour le produit
  p.qte = rand() % 101;
  printf("Entrer le prix du produit: \n");
  scanf("%d", &p.prix);
  do {
    printf("Entrer la taille du produit : \n - 1 pour petit,\n - 2 pour moyen, \n - 4 pour grand, \n");
    scanf("%d", &p.taille);
  } while ((p.taille != 1) && (p.taille != 2) && (p.taille != 4));

  return p;
}


// Permet de stocker un produit dans un fichier
FILE* FichierProduit(Produit p) {
  FILE *fichier;
  char nom[30];

  printf("Saisissez le nom du fichier pour le produit: %s \n", p.nom);
  scanf("%s.txt", nom);

  fichier = fopen(nom, "w");

  // Verifie l'accessibilité du fichier
  if (fichier == NULL) {
    printf("Ouverture du fichier impossible\n");
    exit(1);
  }

  // Ecrit chaque valeur du produit dans un fichier
  fprintf(fichier, "%s \n", p.nom);
  fprintf(fichier, "%d \n", p.num_ref);
  fprintf(fichier, "%d \n", p.qte);
  fprintf(fichier, "%d \n", p.prix);
  fprintf(fichier, "%d \n", p.taille);
  fclose(fichier);

  return fichier;
}




// Structure Client
typedef struct{
  char nom[50];
  char prenom[50];
  char historique_achat[2];
}Client;


// Fonction qui crée un client 
Client créer_client(){
  Client client;
  printf("Entrer le nom du client \n");
  scanf("%s",client.nom);
  printf("Entrer le prénom du client \n");
  scanf("%s",client.prenom);
  return client;
}

// Permet de stocker un client dans fichier
FILE* FichiersClient(Client client){
  FILE* fichier;
    char nom[50];

  printf("Saisissez le nom du fichier pour le client: %s \n", client.nom);
  scanf("%s.txt", nom);

  fichier = fopen(nom, "w");

  // Verifie l'accessibilité du fichier
  if (fichier == NULL) {
    printf("Ouverture du fichier impossible\n");
    exit(1);
  }

  // Ecrit les données du client dans un fichier
  fprintf(fichier, "%s \n", client.nom);
  fprintf(fichier, "%s \n", client.prenom);

  return fichier;
}



int main(void) {
  srand(time(NULL));

  // Créé un fichier maillot psg
  Produit p1;
  FILE *fichier1;
  p1 = CreateProduit();
  fichier1 = FichierProduit(p1);

  // Créé un fichier maillot real
  Produit p2;
  FILE *fichier2;
  p2 = CreateProduit();
  fichier2 = FichierProduit(p2);

  // Créé un fichier maillot barca
  Produit p3;
  FILE *fichier3;
  p3 = CreateProduit();
  fichier3 = FichierProduit(p3);

  // Créé un fichier maillot city
  Produit p4;
  FILE *fichier4;
  p4 = CreateProduit();
  fichier4 = FichierProduit(p4);

  // Créé un fichier maillot bayern
  Produit p5;
  FILE *fichier5;
  p5 = CreateProduit();
  fichier5 = FichierProduit(p5);
  
  
  // Crée client 1
  FILE *fichierclient1;
  Client client1 = créer_client();
  fichierclient1=FichiersClient(client1);

  return 0;
}
